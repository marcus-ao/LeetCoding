# 304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜

## ğŸ“‹ é¢˜ç›®ä¿¡æ¯
- **éš¾åº¦**ï¼šä¸­ç­‰
- **æ ‡ç­¾**ï¼šè®¾è®¡ã€æ•°ç»„ã€çŸ©é˜µã€å‰ç¼€å’Œ
- **æ¥æº**ï¼šLeetCode

## ğŸ“– é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ `matrix`ï¼Œä»¥ä¸‹ç±»å‹çš„å¤šä¸ªè¯·æ±‚ï¼š

* è®¡ç®—å…¶å­çŸ©å½¢èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼Œè¯¥å­çŸ©é˜µçš„ **å·¦ä¸Šè§’** ä¸º `(row1, col1)` ï¼Œ**å³ä¸‹è§’** ä¸º `(row2, col2)` ã€‚

å®ç° `NumMatrix` ç±»ï¼š

* `NumMatrix(int[][] matrix)` ç»™å®šæ•´æ•°çŸ©é˜µ `matrix` è¿›è¡Œåˆå§‹åŒ–
* `int sumRegion(int row1, int col1, int row2, int col2)` è¿”å› **å·¦ä¸Šè§’** `(row1, col1)` ã€**å³ä¸‹è§’** `(row2, col2)` æ‰€æè¿°çš„å­çŸ©é˜µçš„å…ƒç´  **æ€»å’Œ** ã€‚

### ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼š**
```text
è¾“å…¥: 
["NumMatrix","sumRegion","sumRegion","sumRegion"]
[[[[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]],[2,1,4,3],[1,1,2,2],[1,2,2,4]]
è¾“å‡º: 
[null, 8, 11, 12]

è§£é‡Š:
NumMatrix numMatrix = new NumMatrix([[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]);
numMatrix.sumRegion(2, 1, 4, 3); // return 8 (çº¢è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
numMatrix.sumRegion(1, 1, 2, 2); // return 11 (ç»¿è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
numMatrix.sumRegion(1, 2, 2, 4); // return 12 (è“è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
```

### çº¦æŸæ¡ä»¶

- `m == matrix.length`
- `n == matrix[i].length`
- `1 <= m, n <= 200`
- `-10^5 <= matrix[i][j] <= 10^5`
- `0 <= row1 <= row2 < m`
- `0 <= col1 <= col2 < n`
- æœ€å¤šè°ƒç”¨ `10^4` æ¬¡ `sumRegion` æ–¹æ³•

---

## ğŸ¤” é¢˜ç›®åˆ†æ

### é—®é¢˜ç†è§£

è¿™æ˜¯ç»å…¸é¢˜ç›®ã€303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜ã€‘çš„äºŒç»´å‡çº§ç‰ˆã€‚æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªä¸å¯å˜çš„äºŒç»´çŸ©é˜µä¸­ï¼Œå¿«é€Ÿè®¡ç®—å‡ºä»»æ„æŒ‡å®šçš„çŸ©å½¢æ¡†å†…çš„å…ƒç´ æ€»å’Œã€‚

å…³é”®ç‚¹ï¼š
- **çŸ©é˜µä¸å¯å˜**ï¼šåˆå§‹åŒ–åï¼ŒçŸ©é˜µé‡Œçš„æ•°å­—æ°¸è¿œä¸ä¼šå˜ã€‚
- **æŸ¥è¯¢æ¬¡æ•°æå¤š**ï¼šé«˜è¾¾ `10^4` æ¬¡è°ƒç”¨ã€‚
- **é˜²è¶…æ—¶ï¼ˆTLEï¼‰**ï¼šå¦‚æœæ¯æ¬¡æŸ¥è¯¢éƒ½ç”¨åŒé‡ for å¾ªç¯éå†çŸ©å½¢å†…çš„æ‰€æœ‰ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šéå¸¸é«˜ï¼Œå¿…é¡»é€šè¿‡â€œç©ºé—´æ¢æ—¶é—´â€åœ¨åˆå§‹åŒ–é˜¶æ®µåšå¥½é¢„å¤„ç†ï¼Œè®©æŸ¥è¯¢æ“ä½œé™åˆ°å¸¸æ•°çº§åˆ« `O(1)`ã€‚

### å…³é”®è§‚å¯Ÿ

ä¸€ç»´æ•°ç»„ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ `å‰ç¼€å’Œæ•°ç»„` çš„ç›¸å‡æ¥æ±‚ä»»æ„åŒºé—´å’Œï¼›åœ¨äºŒç»´çŸ©é˜µä¸­ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥åˆ©ç”¨ **äºŒç»´å‰ç¼€å’Œ**ï¼Œé€šè¿‡ç®€å•çš„åŠ å‡æ³•ï¼ˆå®¹æ–¥åŸç†ï¼‰åœ¨ `O(1)` æ—¶é—´å†…ç®—å‡ºä»»æ„ä¸€å—å­çŸ©é˜µçš„é¢ç§¯ï¼ˆå’Œï¼‰ã€‚

---

## ğŸ’¡ è§£é¢˜æ€è·¯

### æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•

#### æ€è·¯è¯´æ˜
åœ¨ `sumRegion` æ–¹æ³•ä¸­ï¼Œç›´æ¥ä½¿ç”¨åŒé‡å¾ªç¯ã€‚å¤–å±‚å¾ªç¯æ§åˆ¶è¡Œï¼ˆä» `row1` åˆ° `row2`ï¼‰ï¼Œå†…å±‚å¾ªç¯æ§åˆ¶åˆ—ï¼ˆä» `col1` åˆ° `col2`ï¼‰ï¼Œå°†å¯¹åº”åæ ‡çš„å€¼ç´¯åŠ ã€‚

#### ç®—æ³•æ­¥éª¤
1. åœ¨æ„é€ å‡½æ•° `__init__` ä¸­ä¿å­˜æ•´ä¸ªçŸ©é˜µã€‚
2. åœ¨æŸ¥è¯¢ `sumRegion` ä¸­è¿›è¡ŒåŒé‡ `for` å¾ªç¯ç´¯åŠ å¹¶è¿”å›ç»“æœã€‚

#### å¤æ‚åº¦åˆ†æ
- **æ—¶é—´å¤æ‚åº¦**ï¼šåˆå§‹åŒ– O(1)ã€‚æŸ¥è¯¢å•æ¬¡æœ€å O(mÃ—n)ï¼ˆå½“æŸ¥è¯¢æ•´ä¸ªçŸ©é˜µæ—¶ï¼‰ã€‚å¦‚æœæœ‰ Q æ¬¡æŸ¥è¯¢ï¼Œæ€»æ—¶é—´å°±æ˜¯ O(QÃ—mÃ—n)ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼šO(mÃ—n)ï¼Œç”¨äºä¿å­˜åŸçŸ©é˜µã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–
åœ¨æç«¯æ•°æ®ä¸‹ï¼ˆm, n=200ï¼ŒQ=10^4ï¼‰ï¼Œæ€»è®¡ç®—é‡å°†è¾¾åˆ° `200 * 200 * 10000 = 4*10^8` æ¬¡æ“ä½œï¼Œå¾ˆå®¹æ˜“è¶…å‡ºæ—¶é—´é™åˆ¶ã€‚æˆ‘ä»¬è¿«åˆ‡éœ€è¦ä¸€ç§ `O(1)` çš„æŸ¥è¯¢æ–¹æ³•ã€‚

---

### æ–¹æ³•äºŒï¼šä¼˜åŒ–è§£æ³•ï¼ˆäºŒç»´å‰ç¼€å’Œï¼‰

#### ğŸŒŸ å½¢è±¡åŒ–ç†è§£ï¼ˆé‡ç‚¹ï¼šä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼‰

> **ğŸ’¡ åœ¨è¿›å…¥ä¸“ä¸šç®—æ³•åˆ†æä¹‹å‰ï¼Œå…ˆé€šè¿‡ä¸€ä¸ªç”Ÿæ´»åŒ–çš„ä¾‹å­æ¥ç†è§£ä¼˜åŒ–æ€è·¯çš„æœ¬è´¨**

**åœºæ™¯ç±»æ¯”**ï¼šè®¡ç®—åœ°å—çš„é¢ç§¯æˆ–é€ ä»·

æƒ³è±¡ä½ é¢å¯¹ç€ä¸€å¼ å·¨å¤§çš„ã€åˆ’åˆ†æˆç½‘æ ¼çš„åœŸåœ°åœ°å›¾ï¼Œæ¯å—ç½‘æ ¼ä¸Šå†™ç€è¿™å—åœ°çš„é€ ä»·ã€‚å¸‚æ”¿éƒ¨é—¨æœ‰ä¸€æœ¬ç¥å¥‡çš„è´¦æœ¬ï¼Œä¸Šé¢è®°å½•äº†**ä»åœ°å›¾å·¦ä¸Šè§’ `(0,0)` èµ·ï¼Œä¸€ç›´åˆ°ä»»æ„ä¸€å—åœ° `(i,j)` æ‰€æ¡†å‡ºçš„æ‰€æœ‰åœŸåœ°çš„æ€»é€ ä»·**ã€‚

ç°åœ¨ä½ æƒ³ä¹°ä¸€å—ä½äºä¸­é—´çš„çŸ©å½¢åœ°çš®ï¼ˆå³æˆ‘ä»¬çš„ `row1, col1` åˆ° `row2, col2`ï¼‰ï¼Œè¯¥æ€ä¹ˆç®—ä»·æ ¼ï¼Ÿ

**å¯¹åº”å…³ç³»**ï¼š
- **å¸‚æ”¿ç¥å¥‡è´¦æœ¬ä¸Šçš„é€ ä»·** = æˆ‘ä»¬è¦é¢„å¤„ç†æ„å»ºçš„ **äºŒç»´å‰ç¼€å’Œæ•°ç»„ `prefix`**
- **æƒ³ä¹°çš„ä¸­é—´çŸ©å½¢åœ°çš®ä»·æ ¼** = æŸ¥è¯¢ `sumRegion`
- **æ€ä¹ˆç®—è´¦**ï¼š
  1. å…ˆæŸ¥å‡ºåŒ…å«ä½ æƒ³ä¹°çš„åœ°çš®ã€å¹¶ä¸”ä¸€ç›´å»¶ä¼¸åˆ°å·¦ä¸Šè§’çš„**å¤§çŸ©å½¢æ€»ä»·**ã€‚
  2. å‡å»ä½ ä¸éœ€è¦çš„**ä¸Šæ–¹é‚£å—å¤šä½™çŸ©å½¢**ã€‚
  3. å‡å»ä½ ä¸éœ€è¦çš„**å·¦æ–¹é‚£å—å¤šä½™çŸ©å½¢**ã€‚
  4. âš ï¸ç­‰ä¸€ä¸‹ï¼å·¦ä¸Šè§’é‚£å—æœ€æ ¸å¿ƒçš„é‡å åŒºåŸŸï¼Œä½ åˆšæ‰å‡ä¸Šæ–¹æ—¶å‡äº†ä¸€æ¬¡ï¼Œå‡å·¦æ–¹æ—¶åˆå‡äº†ä¸€æ¬¡ï¼ˆå‡äº†ä¸¤æ¬¡ï¼‰ã€‚æ‰€ä»¥å¿…é¡»**åŠ å›æ¥ä¸€æ¬¡**ï¼

**æ ¸å¿ƒç†è§£**ï¼š
è¿™å°±æ˜¯æ•°å­¦ä¸Šçš„ **å®¹æ–¥åŸç†ï¼ˆInclusion-Exclusion Principleï¼‰**ã€‚åˆ©ç”¨å››ä¸ªå·²ç»ç®—å¥½çš„ä»å·¦ä¸Šè§’å‡ºå‘çš„å¤§å‰ç¼€å’Œï¼Œé€šè¿‡â€œä¸€å‡ã€äºŒå‡ã€ä¸‰åŠ â€è¿™å››æ­¥ï¼Œç¬é—´å°±èƒ½å¾—åˆ°å†…éƒ¨ä»»æ„å°çŸ©å½¢çš„å€¼ï¼

**ä»ç±»æ¯”åˆ°ç®—æ³•**ï¼š
ç°åœ¨è®©æˆ‘ä»¬æŠŠè¿™ä¸ªæ€æƒ³è½¬åŒ–ä¸ºå…·ä½“çš„æ•°ç»„å’Œåæ ‡...

---

#### ä¼˜åŒ–æ€è·¯æ¨å¯¼

**æ€è€ƒè¿‡ç¨‹**ï¼š
æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªäºŒç»´å‰ç¼€å’Œæ•°ç»„ `prefix`ã€‚ä¸ºäº†é¿å…å¤„ç†ç¹ççš„è¶Šç•Œåˆ¤æ–­ï¼ˆæ¯”å¦‚æŸ¥è¯¢ç¬¬ 0 è¡Œæ—¶å»å‡ä¸Šä¸€è¡Œï¼‰ï¼Œæˆ‘ä»¬ç»™å‰ç¼€å’ŒçŸ©é˜µçš„**ä¸Šæ–¹å’Œå·¦æ–¹å„å¢åŠ ä¸€è¡Œå’Œä¸€åˆ—çš„ 0**ï¼ˆç±»ä¼¼ä¸€ç»´å‰ç¼€å’Œä¸­åœ¨é¦–ä½è¡¥ 0ï¼‰ã€‚

ä»¤ `prefix[i+1][j+1]` è¡¨ç¤ºä» `matrix[0][0]` ç´¯åŠ åˆ° `matrix[i][j]` çš„æ€»å’Œã€‚

**1. å¦‚ä½•é¢„å¤„ç†è®¡ç®— `prefix[i+1][j+1]`ï¼Ÿ**ï¼ˆä¹Ÿæ˜¯å®¹æ–¥åŸç†ï¼‰
- å®ƒç­‰äºå½“å‰è‡ªèº«çš„å€¼ `matrix[i][j]`
- åŠ ä¸Šå®ƒä¸Šæ–¹çš„æ€»å’Œ `prefix[i][j+1]`
- åŠ ä¸Šå®ƒå·¦æ–¹çš„æ€»å’Œ `prefix[i+1][j]`
- å‡å»å·¦ä¸Šæ–¹è¢«é‡å¤åŠ äº†ä¸¤æ¬¡çš„æ€»å’Œ `prefix[i][j]`
- **å…¬å¼**ï¼š`prefix[i+1][j+1] = prefix[i][j+1] + prefix[i+1][j] - prefix[i][j] + matrix[i][j]`

**2. å¦‚ä½•æŸ¥è¯¢ä»»æ„çŸ©å½¢ `(r1, c1)` åˆ° `(r2, c2)`ï¼Ÿ**
- å¯¹åº”çš„å¤§çŸ©å½¢æ˜¯ `prefix[r2+1][c2+1]`
- å‡å»ä¸Šæ–¹çš„çŸ©å½¢ `prefix[r1][c2+1]`
- å‡å»å·¦æ–¹çš„çŸ©å½¢ `prefix[r2+1][c1]`
- åŠ ä¸Šå·¦ä¸Šè§’å¤šå‡äº†ä¸€æ¬¡çš„çŸ©å½¢ `prefix[r1][c1]`
- **å…¬å¼**ï¼š`ans = prefix[r2+1][c2+1] - prefix[r1][c2+1] - prefix[r2+1][c1] + prefix[r1][c1]`

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - åˆå§‹åŒ–ï¼šO(m Ã— n)ï¼ŒåŒé‡å¾ªç¯éå†æ•´ä¸ªçŸ©é˜µç”Ÿæˆå‰ç¼€å’Œã€‚
  - æŸ¥è¯¢ï¼šO(1)ï¼Œæ— è®ºæŸ¥å¤šå¤§çš„çŸ©å½¢ï¼Œéƒ½åªéœ€è¿›è¡Œ 3 æ¬¡åŠ å‡æ³•ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼šO(m Ã— n)ï¼Œæ–°å»ºäº†ä¸€ä¸ª `(m+1) Ã— (n+1)` çš„å‰ç¼€å’ŒçŸ©é˜µã€‚

---

## ğŸ¨ å›¾è§£è¯´æ˜

### æ‰§è¡Œè¿‡ç¨‹ç¤ºä¾‹

å‡è®¾æœ‰ä¸€ä¸ª $3 	imes 3$ çŸ©é˜µå¯»æ‰¾ä¸­é—´çŸ©å½¢çš„å’Œã€‚

**é¢„å¤„ç†æ„å»ºï¼šå½“å‰æ ¼å­çš„å‰ç¼€å’Œæ€ä¹ˆæ¥ï¼Ÿ**
```text
[æ„å»º prefix[i+1][j+1]]
= [å½“å‰ç‚¹] + [ä¸Šæ–¹ä¸€æ•´å—] + [å·¦æ–¹ä¸€æ•´å—] - [å·¦ä¸Šæ–¹é‡å éƒ¨åˆ†]

    (0,0) ---- (0,j)         (0,0)           (0,0) -- (0,j)
      |          |             |               |        |
      |   å·¦ä¸Š   |  ä¸Šæ–¹     (i,0)-- å·¦æ–¹    (i,0) -- (i,j)
      |          |             
    (i,0) ---- (i,j)å½“å‰
```

**æŸ¥è¯¢è®¡ç®—ï¼šæ‰¾çº¢è‰²æ¡† `(r1,c1)` åˆ° `(r2,c2)` çš„é¢ç§¯**
```text
[æœ€ç»ˆé¢ç§¯] = [å·¨å¤§é¢ç§¯] - [ä¸Šæ–¹çŸ©å½¢] - [å·¦æ–¹çŸ©å½¢] + [å·¦ä¸Šè§’é‡å çŸ©å½¢]

æ•´ä¸ªå¤§çŸ©å½¢: prefix[r2+1][c2+1]
ä¸Šæ–¹ä¸éœ€è¦: prefix[r1][c2+1]
å·¦æ–¹ä¸éœ€è¦: prefix[r2+1][c1]
å¤šå‡çš„å·¦ä¸Š: prefix[r1][c1] (å› ä¸ºä¸Šé¢ä¸¤æ­¥éƒ½æŠŠå®ƒå‡æ‰äº†)
```

---

## âœï¸ ä»£ç æ¡†æ¶å¡«ç©º

> **ğŸ’¡ å­¦ä¹ æç¤º**ï¼šåœ¨æŸ¥çœ‹å®Œæ•´ä»£ç ä¹‹å‰ï¼Œå…ˆå°è¯•æ ¹æ®ä¸Šé¢çš„ç®—æ³•æ­¥éª¤ï¼Œè‡ªå·±æ€è€ƒå¹¶å¡«å†™ä¸‹é¢çš„ç©ºç™½å¤„ã€‚

### Pythonå¡«ç©ºç‰ˆ

```python
class NumMatrix:

    def __init__(self, matrix: List[List[int]]):
        if not matrix or not matrix[0]:
            return
        
        m, n = len(matrix), len(matrix[0])
        # ğŸ”¹ å¡«ç©º1ï¼šåˆå§‹åŒ–äºŒç»´å‰ç¼€å’Œæ•°ç»„ï¼Œå¤šåŠ ä¸€è¡Œä¸€åˆ—ä½œä¸ºè¾¹ç•Œ0
        self.prefix = [[0] * (______) for _ in range(______)]
        
        # ğŸ”¹ å¡«ç©º2ï¼šåŒå±‚å¾ªç¯è®¡ç®—æ¯ä¸ªæ ¼å­çš„å‰ç¼€å’Œ
        for i in range(m):
            for j in range(n):
                # æç¤ºï¼šå‰ç¼€å’Œ = ä¸Šæ–¹å’Œ + å·¦æ–¹å’Œ - å·¦ä¸Šæ–¹é‡å  + å½“å‰æ ¼å­å€¼
                self.prefix[______][______] = (self.prefix[______][______] 
                                             + self.prefix[______][______] 
                                             - self.prefix[i][j] 
                                             + matrix[i][j])

    def sumRegion(self, row1: int, col1: int, row2: int, col2: int) -> int:
        # ğŸ”¹ å¡«ç©º3ï¼šåˆ©ç”¨å®¹æ–¥åŸç† O(1) è¿”å›å­çŸ©å½¢çš„å’Œ
        # æç¤ºï¼šå¤§é¢ç§¯ - ä¸Šé¢ç§¯ - å·¦é¢ç§¯ + å·¦ä¸Šè§’å¤šå‡çš„é¢ç§¯
        # æ³¨æ„åŠ ä¸Šåç§»é‡ 1
        return (self.prefix[______][______] 
              - self.prefix[______][______] 
              - self.prefix[______][______] 
              + self.prefix[______][______])
```

### å¡«ç©ºæç¤ºè¯¦è§£

**å¡«ç©º1 - æ•°ç»„ç»´åº¦**
- æ€è€ƒï¼šåŸçŸ©é˜µé•¿ `m` å®½ `n`ã€‚ä¸ºäº†é¿å…ç¬¬ 0 è¡Œ/åˆ—éœ€è¦é¢å¤–åˆ¤æ–­ï¼Œå‰ç¼€å’ŒçŸ©é˜µè¦å„è‡ªå¤š 1ï¼Œåº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ

**å¡«ç©º2 - çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ„å»º**
- æ€è€ƒï¼šå‰ç¼€å’Œä¸­å­˜å‚¨å½“å‰åæ ‡åŠ åç§»é‡1çš„ç»“æœï¼Œå³ `prefix[i+1][j+1]`ã€‚ä¸Šæ–¹æ˜¯ `prefix[i][j+1]`ï¼Œå·¦æ–¹æ˜¯ `prefix[i+1][j]`ã€‚

**å¡«ç©º3 - æŸ¥è¯¢å…¬å¼åº”ç”¨**
- æ€è€ƒï¼šç”±äºåŠ äº†è™šæ‹Ÿ 0 è¾¹ï¼Œå³ä¸‹è§’åŒ…å«åæ ‡å˜æˆäº† `row2+1, col2+1`ã€‚ä¸Šæ–¹å‰”é™¤åˆ° `row1` çš„ä¸Šæ²¿ï¼Œæ‰€ä»¥ä¸ç”¨ `+1`ã€‚å¤šå‡å»çš„é‚£å—æ°å¥½æ˜¯ `row1, col1`ï¼

---

## ğŸ’» å®Œæ•´ä»£ç å®ç°

> **âœ… å¯¹ç…§æ£€æŸ¥**ï¼šç°åœ¨å¯¹æ¯”ä½ çš„å¡«ç©ºç­”æ¡ˆå’Œä¸‹é¢çš„å®Œæ•´å®ç°ï¼Œçœ‹çœ‹æ€è·¯æ˜¯å¦ä¸€è‡´ã€‚

### Pythonå®ç°

```python
from typing import List

class NumMatrix:

    def __init__(self, matrix: List[List[int]]):
        # è¾¹ç•Œæƒ…å†µå¤„ç†
        if not matrix or not matrix[0]:
            return
            
        m, n = len(matrix), len(matrix[0])
        # åˆå§‹åŒ–å‰ç¼€å’Œæ•°ç»„ï¼Œå°ºå¯¸ä¸º (m+1) x (n+1)ï¼Œåˆå§‹å…¨ä¸º0
        # è¿™æ ·å¤„ç†å¯ä»¥åœ¨ä¹‹åè®¡ç®—æ—¶é¿å…å¤„ç† i-1 æˆ– j-1 è¶Šç•Œçš„é—®é¢˜
        self.prefix = [[0] * (n + 1) for _ in range(m + 1)]
        
        # é¢„è®¡ç®—äºŒç»´å‰ç¼€å’Œ
        for i in range(m):
            for j in range(n):
                # çŠ¶æ€è½¬ç§»ï¼šå½“å‰æ ¼å­çš„æ€»å’Œ = ä¸Š + å·¦ - å·¦ä¸Šé‡å  + å½“å‰åŸå€¼
                self.prefix[i + 1][j + 1] = (self.prefix[i][j + 1] 
                                           + self.prefix[i + 1][j] 
                                           - self.prefix[i][j] 
                                           + matrix[i][j])

    def sumRegion(self, row1: int, col1: int, row2: int, col2: int) -> int:
        # æŸ¥è¯¢æ“ä½œï¼š
        # å¤§çŸ©å½¢(åˆ°è¾¾row2,col2) - ä¸Šæ–¹çŸ©å½¢(åªåˆ°è¾¾row1-1) - å·¦æ–¹çŸ©å½¢(åªåˆ°è¾¾col1-1) + å·¦ä¸Šè§’(è¢«å‡äº†ä¸¤æ¬¡)
        # æ³¨æ„å› ä¸º prefix åç§»äº† 1ï¼Œæ‰€ä»¥ row2 å’Œ col2 è¦ +1ï¼Œè€Œ row1 å’Œ col1 åŸæ ·ä¸å˜ï¼ˆæ°å¥½å¯¹åº”å®ƒä»¬å‰ä¸€ä½çš„ä½ç½®ï¼‰
        return (self.prefix[row2 + 1][col2 + 1] 
              - self.prefix[row1][col2 + 1] 
              - self.prefix[row2 + 1][col1] 
              + self.prefix[row1][col1])


# æµ‹è¯•ç”¨ä¾‹
if __name__ == "__main__":
    matrix = [
        [3, 0, 1, 4, 2],
        [5, 6, 3, 2, 1],
        [1, 2, 0, 1, 5],
        [4, 1, 0, 1, 7],
        [1, 0, 3, 0, 5]
    ]
    obj = NumMatrix(matrix)
    print(f"æŸ¥è¯¢ (2,1) åˆ° (4,3): é¢„æœŸ 8, å®é™… {obj.sumRegion(2, 1, 4, 3)}")
    print(f"æŸ¥è¯¢ (1,1) åˆ° (2,2): é¢„æœŸ 11, å®é™… {obj.sumRegion(1, 1, 2, 2)}")
```

**å¡«ç©ºç­”æ¡ˆè§£æ**ï¼š
- **å¡«ç©º1**ï¼š`n+1` å’Œ `m+1`ã€‚åˆ›å»ºå¤§ä¸€åœˆçš„çŸ©é˜µæ¥å®¹çº³è™šæ‹Ÿè¾¹ç•Œ `0`ã€‚
- **å¡«ç©º2**ï¼š`[i+1][j+1]` = `[i][j+1]` + `[i+1][j]`ã€‚
- **å¡«ç©º3**ï¼š`[row2+1][col2+1] - [row1][col2+1] - [row2+1][col1] + [row1][col1]`ã€‚è¿™å°±æ˜¯ç»å…¸çš„äºŒç»´å‰ç¼€å’ŒæŸ¥è¯¢å››ä»¶å¥—ã€‚

---

### C++å®ç°

```cpp
#include <vector>
using namespace std;

class NumMatrix {
private:
    vector<vector<int>> prefix;

public:
    NumMatrix(vector<vector<int>>& matrix) {
        if (matrix.empty() || matrix[0].empty()) return;
        
        int m = matrix.size();
        int n = matrix[0].size();
        
        // åˆ†é…å°ºå¯¸å¹¶åˆå§‹åŒ–ä¸º0
        prefix.assign(m + 1, vector<int>(n + 1, 0));
        
        // é¢„è®¡ç®—å‰ç¼€å’Œ
        for (int i = 0; i < m; ++i) {
            for (int j = 0; j < n; ++j) {
                prefix[i + 1][j + 1] = prefix[i][j + 1] + prefix[i + 1][j] - prefix[i][j] + matrix[i][j];
            }
        }
    }
    
    int sumRegion(int row1, int col1, int row2, int col2) {
        // æ—¶é—´å¤æ‚åº¦O(1) çš„å®¹æ–¥åŸç†æŸ¥è¯¢
        return prefix[row2 + 1][col2 + 1] 
             - prefix[row1][col2 + 1] 
             - prefix[row2 + 1][col1] 
             + prefix[row1][col1];
    }
};
```

**ä¸Pythonçš„ä¸»è¦å·®å¼‚**ï¼š
- Pythonç”¨åˆ—è¡¨æ¨å¯¼å¼åˆå§‹åŒ–äºŒç»´æ•°ç»„ `[[0] * (n+1) for _ in range(m+1)]`ã€‚C++ ä¸­æ›´æ¨èä½¿ç”¨ `vector::assign` æˆ– `resize` é«˜æ•ˆé‡æ–°åˆ†é…å°ºå¯¸å¹¶èµ‹åˆå€¼ã€‚

---

## âš ï¸ æ˜“é”™ç‚¹æé†’

### 1. æ•°ç»„è¶Šç•Œ / æ²¡æœ‰å¢åŠ è¾¹ç•Œ 0

**æ˜“é”™ç‚¹**ï¼šå¦‚æœä½ åˆ›å»ºçš„ `prefix` ä¸ `matrix` å°ºå¯¸ä¸€æ¨¡ä¸€æ ·ï¼ˆ`m x n`ï¼‰ï¼Œåœ¨æ±‚é¦–è¡Œæˆ–é¦–åˆ—å‰ç¼€å’Œæ—¶ï¼Œæ¯”å¦‚ `prefix[0][j] = prefix[-1][j] + ...`ï¼Œå°±ä¼šé¢ä¸´ `-1` è¶Šç•Œçš„é—®é¢˜ã€‚åŒæ—¶ï¼Œåœ¨æŸ¥è¯¢æ—¶ï¼Œå¦‚æœ `row1 == 0`ï¼Œä½ å»å‡å» `prefix[row1 - 1][col2]` æ—¶ä¹Ÿä¼šæŠ¥é”™ã€‚

**æ­£ç¡®å¤„ç†**ï¼š
æ°¸è¿œåšæŒç»™å‰ç¼€å’ŒçŸ©é˜µåˆ†é… `(m+1) x (n+1)` çš„ç©ºé—´ã€‚ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„ 0 å¯ä»¥å®Œç¾åœ°å¤„ç†æ‰€æœ‰è¾¹ç•Œè¿ç®—ï¼Œè¿™å«â€œå“¨å…µèŠ‚ç‚¹â€ï¼ˆDummy paddingï¼‰çš„æ€æƒ³ã€‚

### 2. æ··æ·†åŸåæ ‡å’Œ prefix åæ ‡

**é”™è¯¯åŸå› **ï¼šæˆ‘ä»¬ç”±äºå°† prefix çš„åŸç‚¹å‘å³ä¸‹æ–¹åç§»äº†ä¸€æ ¼ï¼ˆå› ä¸ºåŠ äº† 0 è¾¹ç•Œï¼‰ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´è·å– `matrix[i][j]` æ˜ å°„çš„é¢ç§¯æ—¶æ‰¾é”™ç‚¹ã€‚
**å·§è®°æ³•**ï¼š
- åŸçŸ©é˜µçš„ `[i, j]` ç‚¹çš„â€œå³ä¸‹è§’æ•´ä½“é¢ç§¯â€ï¼Œå¯¹åº”åˆ° `prefix` ä¸­ä¸€å¾‹æ˜¯ `[i+1][j+1]`ã€‚
- æŸ¥è¯¢ `row1 ~ row2` åŒºé—´æ—¶ï¼š
  å¤§çŸ©å½¢è¦åŒ…å« `row2`ï¼Œæ‰€ä»¥åæ ‡æ˜¯ `row2 + 1`ã€‚
  è¦å‡å»çš„ä¸ŠåŠéƒ¨åˆ†çŸ©å½¢**ä¸åŒ…å«** `row1`ï¼ˆåªåˆ° `row1 - 1`ï¼‰ï¼Œæ‰€ä»¥å®ƒçš„åŸåæ ‡èŒƒå›´æ˜¯åˆ° `row1 - 1`ï¼ŒåŠ  1 ååˆšå¥½å¯¹åº”åˆ° `prefix` é‡Œçš„ `row1`ã€‚
- **å…¬å¼å£è¯€**ï¼šå¤§è§’éƒ½åŠ 1ï¼Œå°è§’å…¨ä¸å˜ï¼ˆå³è¢«å‡å»çš„è¡Œã€åˆ—å·ä¸å˜ï¼‰ã€‚

---

## ğŸ”— ç›¸ä¼¼é¢˜ç›®æ¨è

### åŒç±»å‹é¢˜ç›®

1. **[LeetCode 303] - åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜** (Easy)
   - ç›¸ä¼¼ç‚¹ï¼šæœ¬é¢˜çš„é€€åŒ–ç‰ˆï¼ˆä¸€ç»´å‰ç¼€å’Œï¼‰ï¼Œæ€æƒ³å®Œå…¨ä¸€è‡´ã€‚

2. **[LeetCode 1292] - å…ƒç´ å’Œä¸ºç›®æ ‡å€¼çš„å­çŸ©é˜µæ•°é‡** (Medium)
   - ç›¸ä¼¼ç‚¹ï¼šéœ€è¦æšä¸¾å¹¶æŸ¥æ‰¾å­çŸ©é˜µå…ƒç´ çš„å’Œï¼Œå¦‚æœæ²¡æœ‰ `O(1)` çš„äºŒç»´å‰ç¼€å’Œä½œæ”¯æ’‘ï¼Œæ—¶é—´å¤æ‚åº¦å°†é«˜åˆ°æ— æ³•æ¥å—ã€‚

### è¿›é˜¶é¢˜ç›®

1. **[LeetCode 363] - çŸ©å½¢åŒºåŸŸä¸è¶…è¿‡ K çš„æœ€å¤§æ•°å€¼å’Œ** (Hard)
   - è¿›é˜¶ç‚¹ï¼šè¿™æ˜¯äºŒç»´å‰ç¼€å’Œä¸å…¶ä»–æ•°æ®ç»“æ„ï¼ˆå¦‚æœ‰åºé›†åˆã€äºŒåˆ†æŸ¥æ‰¾ï¼‰å¼ºå¼ºç»“åˆçš„é«˜éš¾åº¦ç»¼åˆé¢˜ã€‚å½“ä½ å½»åº•æŒæ¡äº†äºŒç»´å‰ç¼€å’Œæ¨¡æ¿åï¼Œå¯ä»¥æ¥æŒ‘æˆ˜ã€‚

---

## ğŸ“š çŸ¥è¯†ç‚¹æ€»ç»“

### æ ¸å¿ƒç®—æ³•ï¼šäºŒç»´å‰ç¼€å’Œ (2D Prefix Sum)
å®ƒæ˜¯ä¸€ç»´å‰ç¼€å’Œçš„è‡ªç„¶å»¶ä¼¸ï¼Œæ ¸å¿ƒæ•°å­¦æ”¯æ’‘æ˜¯**å®¹æ–¥åŸç†**ã€‚å®ƒéå¸¸ä¼˜é›…åœ°å°†ä¸€ä¸ªä¸å¯å˜äºŒç»´ç½‘æ ¼ä¸­çš„åŒºåŸŸæ±‚å’ŒæŸ¥è¯¢é—®é¢˜çš„æ—¶é—´å¤æ‚åº¦ä» $O(n^2)$ å‹æ¦¨åˆ°äº†ç»å¯¹çš„ $O(1)$ã€‚

### è§£é¢˜æ¨¡æ¿ (è¯·èƒŒè¯µ)

```python
# åˆå§‹åŒ– (m+1) x (n+1) çš„0çŸ©é˜µ
prefix = [[0] * (n + 1) for _ in range(m + 1)]

# é¢„å¤„ç†æ„å»ºå…¬å¼ï¼š
prefix[i+1][j+1] = prefix[i][j+1] + prefix[i+1][j] - prefix[i][j] + matrix[i][j]

# O(1) æŸ¥è¯¢å…¬å¼ï¼š
sum = prefix[r2+1][c2+1] - prefix[r1][c2+1] - prefix[r2+1][c1] + prefix[r1][c1]
```

### å­¦ä¹ è¦ç‚¹
1. **é¢„å¤„ç†æ€ç»´**ï¼šä¸€æ—¦çœ‹åˆ°â€œå¤šæ¬¡æŸ¥è¯¢â€ã€â€œä¸å¯å˜â€ï¼ˆImmutableï¼‰çš„å­—çœ¼ï¼Œå¿…é¡»æ¡ä»¶åå°„èˆ¬åœ°æƒ³åˆ°é¢„å¤„ç†ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚
2. **å“¨å…µæ€æƒ³ (Dummy padding)**ï¼šé€šè¿‡é¢å¤–é¢„ç•™è¾¹ç•Œ0ï¼Œå·§å¦™è§„é¿ä»£ç ä¸­æ¶å¿ƒçš„æ— æ•°ä¸ª `if i == 0` åˆ¤æ–­ï¼Œä½¿å¾—å¾ªç¯å’Œå…¬å¼å˜å¾—æåº¦æ¸…çˆ½ã€‚
3. **å›¾æ–‡ç»“åˆè®°å¿†**ï¼šä¸è¦æ­»è®°ç¡¬èƒŒå››ä¸ªåŠ å‡é¡¹ã€‚è‡ªå·±ç”»ä¸€ä¸ªå¤§çŸ©å½¢ï¼Œåˆ‡æˆå››å—ï¼Œæƒ³æƒ³æ€æ ·é€šè¿‡é‡å æ‹¼å‡‘å‡ºæ ¸å¿ƒåŒºåŸŸï¼Œè‡ªç„¶å°±èƒ½æ¨å¯¼å‡ºå®¹æ–¥åŸç†ã€‚
