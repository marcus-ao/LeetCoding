# 1314. çŸ©é˜µåŒºåŸŸå’Œ

## ğŸ“‹ é¢˜ç›®ä¿¡æ¯
- **éš¾åº¦**ï¼šä¸­ç­‰
- **æ ‡ç­¾**ï¼šæ•°ç»„ã€çŸ©é˜µã€å‰ç¼€å’Œ
- **æ¥æº**ï¼šLeetCode

## ğŸ“– é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ª `m x n` çš„çŸ©é˜µ `mat` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œè¯·ä½ è¿”å›ä¸€ä¸ªçŸ©é˜µ `answer` ï¼Œå…¶ä¸­æ¯ä¸ª `answer[i][j]` æ˜¯æ‰€æœ‰æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„å…ƒç´  `mat[r][c]` çš„å’Œï¼š 

* `i - k <= r <= i + k,`
* `j - k <= c <= j + k` ä¸”
* `(r, c)` åœ¨çŸ©é˜µå†…ã€‚

### ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼š**
```text
è¾“å…¥ï¼šmat = [[1,2,3],[4,5,6],[7,8,9]], k = 1
è¾“å‡ºï¼š[[12,21,16],[27,45,33],[24,39,28]]
```

**ç¤ºä¾‹ 2ï¼š**
```text
è¾“å…¥ï¼šmat = [[1,2,3],[4,5,6],[7,8,9]], k = 2
è¾“å‡ºï¼š[[45,45,45],[45,45,45],[45,45,45]]
```

### çº¦æŸæ¡ä»¶
* `m == mat.length`
* `n == mat[i].length`
* `1 <= m, n, k <= 100`
* `1 <= mat[i][j] <= 100`

---

## ğŸ¤” é¢˜ç›®åˆ†æ

### é—®é¢˜ç†è§£

é¢˜ç›®è¦æ±‚æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªä¸åŸçŸ©é˜µå¤§å°ç›¸åŒçš„ç­”æ¡ˆçŸ©é˜µ `answer`ã€‚å…¶ä¸­ï¼Œ`answer` ä¸­çš„æ¯ä¸€ä¸ªæ ¼å­ `(i, j)` çš„å€¼ï¼Œéƒ½ç­‰äºåŸçŸ©é˜µ `mat` ä¸­**ä»¥ `(i, j)` ä¸ºä¸­å¿ƒã€è¾¹é•¿ä¸º `2k+1` çš„æ­£æ–¹å½¢åŒºåŸŸ** (ps: â€œæ­£æ–¹å½¢åŒºåŸŸâ€è¿™ä¸ªè¯´æ³•ä¸å®Œå…¨å‡†ç¡®ï¼Œä¼šå‡ºç°çŸ©å½¢åŒºåŸŸçš„æƒ…å†µ)å†…æ‰€æœ‰å…ƒç´ çš„æ€»å’Œã€‚å½“ç„¶ï¼Œè¿™ä¸ªæ­£æ–¹å½¢åŒºåŸŸä¸èƒ½è¶Šè¿‡åŸçŸ©é˜µçš„è¾¹ç•Œã€‚

å…³é”®ç‚¹ï¼š
- **å¤§é‡é‡å¤çš„åŒºåŸŸæŸ¥è¯¢**ï¼šæˆ‘ä»¬éœ€è¦å¯¹çŸ©é˜µä¸­çš„ **æ¯ä¸€ä¸ªæ ¼å­** è¿›è¡Œä¸€æ¬¡åŒºåŸŸæ±‚å’Œã€‚
- **è¾¹ç•Œé™åˆ¶**ï¼šæ­£æ–¹å½¢æ¡†åœ¨è¾¹ç¼˜æ ¼å­æ—¶ä¼šè¢«çŸ©é˜µè¾¹ç•Œæˆªæ–­ã€‚
- **å…³è”æ€§**ï¼šè¿™é“é¢˜å®Œå…¨å°±æ˜¯ **ã€304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜ã€‘** çš„æ‰¹é‡åº”ç”¨ç‰ˆï¼

### å…³é”®è§‚å¯Ÿ

åœ¨ 304 é¢˜ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•é€šè¿‡â€œäºŒç»´å‰ç¼€å’Œâ€åœ¨ $O(1)$ æ—¶é—´å†…æ±‚å‡ºä»»æ„ä¸€ä¸ªå­çŸ©å½¢çš„å…ƒç´ å’Œã€‚æœ¬é¢˜éœ€è¦å¯¹ $m \times n$ ä¸ªä¸­å¿ƒç‚¹æ±‚çŸ©å½¢å’Œã€‚å¦‚æœæˆ‘ä»¬ç”¨äºŒç»´å‰ç¼€å’Œï¼Œæ€»å…±åªéœ€è¦ $m \times n$ æ¬¡ $O(1)$ çš„æŸ¥è¯¢ï¼Œæ€»æ—¶é—´å¤æ‚åº¦å°†è¢«å®Œç¾é™åˆ° $O(m \times n)$ã€‚

---

## ğŸ’¡ è§£é¢˜æ€è·¯

### æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•

#### æ€è·¯è¯´æ˜
é’ˆå¯¹ç­”æ¡ˆçŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªä½ç½® `(i, j)`ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨ä¸¤å±‚åµŒå¥—å¾ªç¯ï¼Œéå†ä» `i-k` åˆ° `i+k` çš„è¡Œï¼Œä»¥åŠ `j-k` åˆ° `j+k` çš„åˆ—ï¼ŒæŠŠèŒƒå›´å†…çš„å…ƒç´ ç´¯åŠ èµ·æ¥ã€‚

#### ç®—æ³•æ­¥éª¤
1. åˆå§‹åŒ–ç»“æœçŸ©é˜µ `answer`ã€‚
2. éå†æ¯ä¸€ä¸ªä¸­å¿ƒç‚¹ `(i, j)`ã€‚
3. è®¡ç®—åˆæ³•çš„éå†è¾¹ç•Œï¼šè¡ŒèŒƒå›´ `[max(0, i-k), min(m-1, i+k)]`ï¼Œåˆ—èŒƒå›´ `[max(0, j-k), min(n-1, j+k)]`ã€‚
4. åœ¨ä¸Šè¿°åˆæ³•è¾¹ç•Œå†…ï¼Œç”¨åŒé‡å¾ªç¯ç´¯åŠ  `mat` çš„å€¼ã€‚

#### å¤æ‚åº¦åˆ†æ
- **æ—¶é—´å¤æ‚åº¦**ï¼š$O(m \times n \times k^2)$ã€‚çŸ©é˜µå…±æœ‰ $m \times n$ ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æœ€åæƒ…å†µä¸‹éœ€è¦ç´¯åŠ  $(2k+1)^2$ ä¸ªæ ¼å­ã€‚è‹¥ $m, n, k$ éƒ½ä¸º 100ï¼Œæ“ä½œæ¬¡æ•°çº¦ä¸º $100 \times 100 \times 200 \times 200 = 4 \times 10^8$ï¼Œæœ‰è¶…æ—¶é£é™©ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š$O(1)$ï¼ˆä¸è€ƒè™‘è¿”å›çš„ç­”æ¡ˆçŸ©é˜µï¼‰ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–
è¿™å…¶ä¸­å­˜åœ¨ç€å¤§é‡çš„**é‡å¤è®¡ç®—**ã€‚ç›¸é‚»ä¸¤ä¸ªæ ¼å­çš„æ­£æ–¹å½¢åŒºåŸŸæœ‰æå¤§çš„é‡å ï¼Œæš´åŠ›è§£æ³•å®Œå…¨æ— è§†äº†è¿™äº›é‡å ï¼Œå¯¼è‡´æ—¶é—´è¢«æµªè´¹ã€‚æˆ‘ä»¬éœ€è¦ç”¨å‰ç¼€å’Œæ¥æ¶ˆé™¤é‡å¤è®¡ç®—ã€‚

---

### æ–¹æ³•äºŒï¼šä¼˜åŒ–è§£æ³•ï¼ˆäºŒç»´å‰ç¼€å’Œï¼‰

#### ğŸŒŸ å½¢è±¡åŒ–ç†è§£ï¼ˆé‡ç‚¹ï¼šä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼‰

> **ğŸ’¡ åœ¨è¿›å…¥ä¸“ä¸šç®—æ³•åˆ†æä¹‹å‰ï¼Œå…ˆé€šè¿‡ä¸€ä¸ªç”Ÿæ´»åŒ–çš„ä¾‹å­æ¥ç†è§£ä¼˜åŒ–æ€è·¯çš„æœ¬è´¨**

**åœºæ™¯ç±»æ¯”**ï¼šå¸‚æ”¿è§„åˆ’çš„â€œç¹ååº¦â€è¯„ä¼°

æƒ³è±¡ä½ æ˜¯ä¸€ååŸå¸‚è§„åˆ’å¸ˆã€‚åŸå¸‚è¢«åˆ’åˆ†ä¸º $m \times n$ ä¸ªè¡—åŒºç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼é‡Œæœ‰ä¸€å®šçš„äººå£ï¼ˆå¯¹åº” `mat[i][j]`ï¼‰ã€‚
ç°åœ¨çš„ä»»åŠ¡æ˜¯ï¼šä½ éœ€è¦ç»™**æ¯ä¸€ä¸ª**è¡—åŒºè·¯å£ `(i, j)` è¯„ä¼°ä¸€ä¸ªâ€œç¹ååº¦â€ã€‚ç¹ååº¦çš„å®šä¹‰æ˜¯ï¼š**ä»¥æ­¤è·¯å£ä¸ºä¸­å¿ƒï¼Œå‘ä¸œå—è¥¿åŒ—å„è¾å°„ $k$ ä¸ªè¡—åŒºèŒƒå›´å†…çš„æ€»äººå£**ã€‚

**æš´åŠ›åšæ³•**ï¼š
æ¯åˆ°ä¸€ä¸ªè·¯å£ï¼Œä½ å°±æ´¾äººæŠŠå‘¨å›´ $k$ æ¡è¡—çš„äººå£æŒ¨ä¸ªå†æ•°ä¸€éã€‚å¦‚æœèµ°åˆ°ä¸‹ä¸€ä¸ªç›¸é‚»çš„è·¯å£ï¼Œåˆæ´¾äººé‡æ–°æŠŠå‘¨å›´æ•°ä¸€éã€‚ç”±äºç›¸é‚»è·¯å£çš„è¾å°„èŒƒå›´å‡ ä¹é‡åˆï¼Œä½ çš„äººå‘˜æ¯å¤©éƒ½åœ¨åšæ— ç”¨åŠŸã€‚

**èªæ˜åšæ³•ï¼ˆåˆ©ç”¨ä¸Šä¸€é¢˜çš„â€œå¸‚æ”¿ç¥å¥‡è´¦æœ¬â€ï¼‰**ï¼š
1. **ç¬¬ä¸€æ­¥ï¼ˆé¢„å¤„ç†è´¦æœ¬ï¼‰**ï¼šå…ˆèŠ±åŠå¤©æ—¶é—´ï¼ŒæŠŠåŸå¸‚ä»å·¦ä¸Šè§’ `(0,0)` åˆ°ä»»æ„ä¸€ç‚¹ `(x,y)` çš„å¤§çŸ©å½¢æ€»äººå£ä¸€æ¬¡æ€§ç®—å¥½ï¼Œç™»è®°æˆä¸€æœ¬ã€Šå‰ç¼€å’Œæ€»è´¦ã€‹ã€‚
2. **ç¬¬äºŒæ­¥ï¼ˆæ‰¹é‡æŸ¥è´¦ï¼‰**ï¼šååœ¨åŠå…¬å®¤é‡Œï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªè·¯å£ `(i, j)`ï¼š
   - ç¡®å®šè¾å°„æ¡†çš„è¾¹ç•Œï¼ˆä¸èƒ½ç®—å‡ºåŸå¤–ï¼‰ï¼šæœ€åŒ—åˆ° `i-k`ï¼Œæœ€å—åˆ° `i+k`ï¼Œæœ€è¥¿åˆ° `j-k`ï¼Œæœ€ä¸œåˆ° `j+k`ã€‚
   - æ‰“å¼€ã€Šå‰ç¼€å’Œæ€»è´¦ã€‹ï¼Œç”¨ç»å…¸çš„**å®¹æ–¥åŸç†**ï¼ˆä¸€å‡ã€äºŒå‡ã€ä¸‰åŠ ï¼‰ï¼Œç¬é—´å¾—å‡ºè¿™ä¸ªè¾å°„æ¡†å†…çš„æ€»äººå£ï¼

**æ ¸å¿ƒç†è§£**ï¼š
æœ¬é¢˜çš„æœ¬è´¨å°±æ˜¯ï¼š**æ„å»ºä¸€æ¬¡äºŒç»´å‰ç¼€å’Œï¼Œç„¶åæ‰§è¡Œ $m \times n$ æ¬¡ 304 é¢˜çš„ `sumRegion` æŸ¥è¯¢ã€‚**

---

#### ä¼˜åŒ–æ€è·¯æ¨å¯¼

**æ€è€ƒè¿‡ç¨‹**ï¼š
1. **æ„å»ºäºŒç»´å‰ç¼€å’Œ `prefix`**ï¼š
   å¼•å…¥å¤§å°ä¸º `(m+1) \times (n+1)` çš„ `prefix` çŸ©é˜µï¼Œå¹¶åœ¨é¦–è¡Œé¦–åˆ—è¡¥ 0ã€‚
   å…¬å¼ï¼š`prefix[i+1][j+1] = prefix[i][j+1] + prefix[i+1][j] - prefix[i][j] + mat[i][j]`

2. **ç¡®ç«‹æŸ¥è¯¢è¾¹ç•Œ**ï¼š
   å¯¹äºä¸­å¿ƒç‚¹ `(i, j)` å’Œè¾å°„åŠå¾„ `k`ï¼š
   - ä¸Šè¾¹ç•Œ `r1 = max(0, i - k)` ï¼ˆä¸èƒ½å°äº 0ï¼‰
   - ä¸‹è¾¹ç•Œ `r2 = min(m - 1, i + k)` ï¼ˆä¸èƒ½è¶…è¿‡ m-1ï¼‰
   - å·¦è¾¹ç•Œ `c1 = max(0, j - k)` ï¼ˆä¸èƒ½å°äº 0ï¼‰
   - å³è¾¹ç•Œ `c2 = min(n - 1, j + k)` ï¼ˆä¸èƒ½è¶…è¿‡ n-1ï¼‰

3. **æé€ŸæŸ¥è¯¢å¹¶å¡«å…… `answer`**ï¼š
   åŒºåŸŸå’Œ = `prefix[r2 + 1][c2 + 1] - prefix[r1][c2 + 1] - prefix[r2 + 1][c1] + prefix[r1][c1]`
   å°†è¿™ä¸ªå’Œå¡«å…¥ `answer[i][j]`ã€‚

#### å¤æ‚åº¦åˆ†æ
- **æ—¶é—´å¤æ‚åº¦**ï¼š$O(m \times n)$ã€‚é¢„å¤„ç†å‰ç¼€å’Œéœ€è¦éå†ä¸€æ¬¡çŸ©é˜µï¼Œè®¡ç®—ç­”æ¡ˆéœ€è¦éå†ä¸€æ¬¡çŸ©é˜µï¼Œå‡æ²¡æœ‰ä»»ä½•é¢å¤–åµŒå¥—å¾ªç¯ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š$O(m \times n)$ï¼Œç”¨äºå­˜å‚¨äºŒç»´å‰ç¼€å’Œæ•°ç»„ `prefix`ã€‚

---

## ğŸ¨ å›¾è§£è¯´æ˜

### è¾¹ç•Œæˆªæ–­çš„å¯è§†åŒ–

å½“ä»¥ `(i, j)` ä¸ºä¸­å¿ƒæ‰©å±• $k$ æ­¥æ—¶ï¼Œå¾ˆå®¹æ˜“â€œè·‘å‡ºâ€çŸ©é˜µå¤–ã€‚é€šè¿‡ `max` å’Œ `min` å‡½æ•°ï¼Œæˆ‘ä»¬å°†æ­£æ–¹å½¢æˆªæ–­åœ¨ç‰©ç†è¾¹ç•Œå†…ã€‚

```text
       0                             n-1
     0 +------------------------------+
       |         è¾¹ç•Œä¸Šé™ (0)         |
       |     +----------------+       |
       |     | (r1, c1)       |       |
       |     |                |       |
       |     |    (i, j)      |       |
       |     |                |       |
       |     |       (r2, c2) |       |
       |     +----------------+       |
       |         è¾¹ç•Œä¸‹é™ (m-1)       |
   m-1 +------------------------------+ 
```

**ç¤ºä¾‹**ï¼šçŸ©é˜µå¤§å° 3x3ï¼Œä¸­å¿ƒç‚¹ `(0,0)`ï¼Œ`k=1`
- ç†è®ºä¸Šè¡ŒèŒƒå›´æ˜¯ `[-1, 1]`ï¼Œåˆ—èŒƒå›´æ˜¯ `[-1, 1]`ã€‚
- æˆªæ–­åï¼š`r1 = max(0, -1) = 0`ï¼Œ`r2 = min(2, 1) = 1`ã€‚
- æ‰€ä»¥å®é™…æŸ¥è¯¢çš„æ˜¯å·¦ä¸Šè§’å­çŸ©å½¢ `[0~1][0~1]`ã€‚

---

## âœï¸ ä»£ç æ¡†æ¶å¡«ç©º

> **ğŸ’¡ å­¦ä¹ æç¤º**ï¼šåœ¨æŸ¥çœ‹å®Œæ•´ä»£ç ä¹‹å‰ï¼Œå…ˆå°è¯•å›å¿† 304 é¢˜çš„æ¨¡æ¿ï¼Œè‡ªå·±æ€è€ƒå¹¶å¡«å†™ä¸‹é¢çš„ç©ºç™½å¤„ã€‚

### Pythonå¡«ç©ºç‰ˆ

```python
class Solution:
    def matrixBlockSum(self, mat: List[List[int]], k: int) -> List[List[int]]:
        m, n = len(mat), len(mat[0])
        
        # 1. é¢„å¤„ç†äºŒç»´å‰ç¼€å’Œï¼ˆå¥—ç”¨æ¨¡æ¿ï¼‰
        # ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—åˆå§‹åŒ–ä¸º 0ï¼Œé˜²æ­¢è¶Šç•Œ
        prefix = [[0] * (n + 1) for _ in range(m + 1)]
        for i in range(m):
            for j in range(n):
                # ğŸ”¹ å¡«ç©º1ï¼šåˆ©ç”¨å®¹æ–¥åŸç†æ„å»º prefix
                prefix[i + 1][j + 1] = ______
        
        # 2. è®¡ç®—æ¯ä¸ªæ ¼å­çš„åŒºåŸŸå’Œ
        ans = [[0] * n for _ in range(m)]
        for i in range(m):
            for j in range(n):
                # ğŸ”¹ å¡«ç©º2ï¼šè®¡ç®—åˆæ³•è¾¹ç•Œï¼Œé˜²æ­¢è¾å°„èŒƒå›´è¶Šå‡ºçŸ©é˜µå¤–
                r1 = max(______, i - k)
                c1 = max(______, j - k)
                r2 = min(______, i + k)
                c2 = min(______, j + k)
                
                # ğŸ”¹ å¡«ç©º3ï¼šåˆ©ç”¨äºŒç»´å‰ç¼€å’Œå…¬å¼ O(1) ç®—å‡ºåŒºåŸŸå’Œ
                # æç¤ºï¼šå¤§çŸ©å½¢ - ä¸ŠçŸ©å½¢ - å·¦çŸ©å½¢ + å·¦ä¸Šè§’çŸ©å½¢
                # è®°å¾—å¤§è§’éœ€è¦ +1ï¼Œå°è§’åŸæ ·ä¿æŒ
                ans[i][j] = (prefix[______][______] 
                           - prefix[______][______] 
                           - prefix[______][______] 
                           + prefix[______][______])
                
        return ans
```

### å¡«ç©ºæç¤ºè¯¦è§£

**å¡«ç©º1 - äºŒç»´å‰ç¼€å’ŒçŠ¶æ€è½¬ç§»**
- æ€è€ƒï¼š`ä¸Š` + `å·¦` - `å·¦ä¸Š` + `å½“å‰æ ¼å­çš„å€¼ mat[i][j]`ã€‚å¯¹åº” `prefix[i][j+1] + prefix[i+1][j] - prefix[i][j] + mat[i][j]`ã€‚

**å¡«ç©º2 - è¾¹ç•Œæˆªæ–­å¤„ç†**
- æ€è€ƒï¼šçŸ©é˜µæœ€å°ç´¢å¼•æ˜¯ 0ï¼Œæœ€å¤§è¡Œç´¢å¼•æ˜¯ `m-1`ï¼Œæœ€å¤§åˆ—ç´¢å¼•æ˜¯ `n-1`ã€‚

**å¡«ç©º3 - O(1) æŸ¥è¯¢åŒºåŸŸå’Œ**
- æ€è€ƒï¼šç”±äºåŠ å…¥äº†å‰ç½® `0`ï¼Œ`r2, c2` å¯¹åº”çš„é¢ç§¯éœ€è¦åœ¨ prefix æ˜ å°„åˆ° `r2 + 1, c2 + 1`ã€‚è¢«å‡å»çš„éƒ¨åˆ†å› ä¸ºä¸åŒ…å« `r1` å’Œ `c1`ï¼Œæ‰€ä»¥å®ƒä»¬çš„ç´¢æ°å¥½æ˜ å°„åˆ° `r1` å’Œ `c1`ã€‚

---

## ğŸ’» å®Œæ•´ä»£ç å®ç°

> **âœ… å¯¹ç…§æ£€æŸ¥**ï¼šç°åœ¨å¯¹æ¯”ä½ çš„å¡«ç©ºç­”æ¡ˆå’Œä¸‹é¢çš„å®Œæ•´å®ç°ï¼Œçœ‹çœ‹æ€è·¯æ˜¯å¦ä¸€è‡´ã€‚

### Pythonå®ç°

```python
from typing import List

class Solution:
    def matrixBlockSum(self, mat: List[List[int]], k: int) -> List[List[int]]:
        m, n = len(mat), len(mat[0])
        
        # 1. é¢„å¤„ç†äºŒç»´å‰ç¼€å’Œï¼ˆå“¨å…µæœºåˆ¶ï¼Œé¢å¤–åŠ ä¸€è¡Œä¸€åˆ—0ï¼‰
        prefix = [[0] * (n + 1) for _ in range(m + 1)]
        for i in range(m):
            for j in range(n):
                prefix[i + 1][j + 1] = (prefix[i][j + 1] 
                                      + prefix[i + 1][j] 
                                      - prefix[i][j] 
                                      + mat[i][j])
        
        # 2. æ‰¹é‡æŸ¥è¯¢å¹¶æ„å»ºç­”æ¡ˆçŸ©é˜µ
        ans = [[0] * n for _ in range(m)]
        for i in range(m):
            for j in range(n):
                # è®¡ç®—å—è¾¹ç•Œé™åˆ¶çš„å®‰å…¨çŸ©å½¢èŒƒå›´
                r1 = max(0, i - k)
                c1 = max(0, j - k)
                r2 = min(m - 1, i + k)
                c2 = min(n - 1, j + k)
                
                # é€šè¿‡å‰ç¼€å’Œå››è§’ç›¸åŠ å‡ O(1) å¾—å‡ºç»“æœ
                # æ³¨æ„ï¼šr2å’Œc2ä½œä¸ºå¤§è¾¹è§’åœ¨prefixä¸­éœ€è¦+1ï¼Œr1å’Œc1ä½œä¸ºå‡å»èŒƒå›´è¾¹ç•Œä¸ç”¨+1
                ans[i][j] = (prefix[r2 + 1][c2 + 1] 
                           - prefix[r1][c2 + 1] 
                           - prefix[r2 + 1][c1] 
                           + prefix[r1][c1])
                
        return ans
```

---

### C++å®ç°

```cpp
#include <vector>
#include <algorithm>
using namespace std;

class Solution {
public:
    vector<vector<int>> matrixBlockSum(vector<vector<int>>& mat, int k) {
        int m = mat.size();
        int n = mat[0].size();
        
        // 1. é¢„å¤„ç†å‰ç¼€å’Œæ•°ç»„
        vector<vector<int>> prefix(m + 1, vector<int>(n + 1, 0));
        for (int i = 0; i < m; ++i) {
            for (int j = 0; j < n; ++j) {
                prefix[i + 1][j + 1] = prefix[i][j + 1] + prefix[i + 1][j] - prefix[i][j] + mat[i][j];
            }
        }
        
        // 2. æ ¹æ®å‰ç¼€å’Œæ‰¹é‡è®¡ç®—ç­”æ¡ˆ
        vector<vector<int>> ans(m, vector<int>(n, 0));
        for (int i = 0; i < m; ++i) {
            for (int j = 0; j < n; ++j) {
                // é™å®šåœ¨çŸ©é˜µçš„ç‰©ç†è¾¹ç•Œå†…
                int r1 = max(0, i - k);
                int c1 = max(0, j - k);
                int r2 = min(m - 1, i + k);
                int c2 = min(n - 1, j + k);
                
                // åˆ©ç”¨å®¹æ–¥åŸç†å…¬å¼è®¡ç®—å­çŸ©é˜µå’Œ
                ans[i][j] = prefix[r2 + 1][c2 + 1] 
                          - prefix[r1][c2 + 1] 
                          - prefix[r2 + 1][c1] 
                          + prefix[r1][c1];
            }
        }
        
        return ans;
    }
};
```

---

## âš ï¸ æ˜“é”™ç‚¹æé†’

### 1. è¾¹ç•Œ `min/max` æ–¹å‘å†™å

**æ˜“é”™ç‚¹**ï¼šå†™æˆ `r1 = min(0, i - k)`ï¼Œè¿™ä¼šå¯¼è‡´åŸæœ¬æƒ³è¦æ‹¦æˆªè´Ÿæ•°ï¼Œç»“æœè´Ÿæ•°æ›´å°è¢«ä¿ç•™äº†ä¸‹æ¥ã€‚
**æ­£ç¡®å¤„ç†**ï¼šä¸‹ç•Œï¼ˆå·¦ä¸Šè§’ï¼‰å’Œ 0 æ¯”å¤§ï¼Œå³ `max(0, ...)`ï¼›ä¸Šç•Œï¼ˆå³ä¸‹è§’ï¼‰å’Œ `m-1/n-1` æ¯”å°ï¼Œå³ `min(m-1, ...)`ã€‚åƒä¸‡ä¸è¦å‡­ç›´è§‰å†™é”™å‡½æ•°ã€‚

### 2. å¿˜äº†æ˜ å°„æ—¶çš„ `+1` åç§»

**æ˜“é”™ç‚¹**ï¼šæŸ¥è¯¢åŒºåŸŸå’Œæ—¶ï¼Œç”±äº `prefix` çš„é¦–è¡Œé¦–åˆ—æ˜¯è™šæ‹Ÿçš„ `0`ï¼ŒåŸçŸ©é˜µä¸­çš„åæ ‡åˆ° `prefix` ä¸­çš„åæ ‡å­˜åœ¨å¹³ç§»ã€‚å¦‚æœç›´æ¥å†™ `prefix[r2][c2]`ï¼Œå°†ä¼šå°‘è®¡ç®—æœ€å¤–å›´çš„ä¸€åœˆæ•°å­—ã€‚
**æ­£ç¡®åšæ³•**ï¼šè®°ä½æŸ¥è¯¢å…¬å¼çš„å£è¯€ **â€œå¤§è§’éƒ½åŠ 1ï¼Œå°è§’å…¨ä¸å˜â€**ï¼Œå³å³ä¸‹è§’ç›¸å…³çš„ `r2`, `c2` è¦å˜æˆ `+1`ï¼Œå·¦ä¸Šè§’ç›¸å…³è¢«å‰”é™¤åŒºåŸŸè¾¹ç•Œ `r1`, `c1` ä¿æŒåŸæ ·ã€‚

---

## ğŸ”— ç›¸ä¼¼é¢˜ç›®æ¨è

### åŒç±»å‹é¢˜ç›®

1. **[LeetCode 304] - äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜** (Medium)
   - ç›¸ä¼¼ç‚¹ï¼šæœ¬é¢˜çš„ç»å¯¹å‰ç½®æ ¸å¿ƒé¢˜ã€‚ææ‡‚äº† 304 é¢˜å°±ç­‰äºåšå‡ºäº† 1314 é¢˜ã€‚
   
2. **[LeetCode 1292] - å…ƒç´ å’Œä¸ºç›®æ ‡å€¼çš„å­çŸ©é˜µæ•°é‡** (Medium)
   - ç›¸ä¼¼ç‚¹ï¼šä¹Ÿæ˜¯å¿…é¡»åœ¨ $O(1)$ æ—¶é—´å†…é¢‘ç¹æŸ¥äºŒç»´å­çŸ©é˜µé¢ç§¯ï¼ŒåŸºäºå‰ç¼€å’Œç»“åˆäºŒåˆ†æœç´¢æˆ–æ»‘åŠ¨çª—å£å¯»æ‰¾è¾¾æ ‡æ­£æ–¹å½¢è¾¹é•¿ã€‚

### è¿›é˜¶é¢˜ç›®

1. **[LeetCode 1139] - æœ€å¤§çš„ä»¥ 1 ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢** (Medium)
   - è¿›é˜¶ç‚¹ï¼šéœ€è¦çµæ´»åº”ç”¨äºŒç»´æ•°ç»„å‰ç¼€å’Œæˆ–è€…æ˜¯å•ç‹¬ç»´æŠ¤è¡Œåˆ—è¿ç»­ 1 çš„ä¸ªæ•°ã€‚

---

## ğŸ“š çŸ¥è¯†ç‚¹æ€»ç»“

### æ ¸å¿ƒè§£é¢˜èŒƒå¼ï¼šä¸šåŠ¡é€»è¾‘è½¬åŒ–ä¸ºæ¨¡æ¿åº”ç”¨

è¿™é“é¢˜æ˜¯å…¸å‹çš„**â€œåŒ…è£…é¢˜â€**ã€‚é¢˜ç›®çœ‹èµ·æ¥åƒä¸€ä¸ªå…¨æ–°çš„ç‰©ç†åœºæ™¯ï¼ˆçŸ©é˜µåŒºåŸŸè¾å°„æ±‚å’Œï¼‰ï¼Œä½†å¦‚æœä½ èƒ½çœ‹é€**â€œé¢‘ç¹æŸ¥è¯¢é™æ€çŸ©é˜µåŒºåŸŸé¢ç§¯â€**çš„æœ¬è´¨ï¼Œå°±èƒ½ç«‹åˆ»å°†å®ƒè½¬åŒ–ä¸º 304 é¢˜çš„äºŒç»´å‰ç¼€å’Œæ¨¡æ¿åº”ç”¨ã€‚

### å­¦ä¹ è¦ç‚¹

1. **ç»„åˆåº”ç”¨çš„èƒ½åŠ›**ï¼šå­¦ä¼šå°†ä¸€ä¸ªéœ€è¦åµŒå¥—å¤šå±‚å¾ªç¯çš„ $O(N^4)$ é—®é¢˜ï¼Œæ‹†è§£æˆâ€œé¢„å¤„ç† $O(N^2)$ + æŸ¥è¯¢ $O(N^2)$â€çš„ä¸¤é˜¶æ®µæµæ°´çº¿ä½œä¸šã€‚
2. **å®‰å…¨è¾¹ç•Œå¤„ç†**ï¼šåœ¨ç®—æ³•ä¸­å¤„ç†â€œè¾å°„â€ã€â€œæ‰©æ•£â€æ¦‚å¿µæ—¶ï¼Œæ°¸è¿œè®°å¾—ä½¿ç”¨ `max()` å’Œ `min()` å‡½æ•°æ¥ä¼˜é›…åœ°å¤„ç†è¶…å‡ºè¾¹ç•Œçš„æƒ…å†µï¼Œè€Œä¸æ˜¯å†™ä¸€å¤§å †æ¶å¿ƒçš„ `if-else`ã€‚
3. **å½»åº•æŒæ¡äºŒç»´å‰ç¼€å’Œ**ï¼šç»è¿‡è¿™é“é¢˜çš„å·©å›ºï¼Œä½ åº”è¯¥å¯¹å®¹æ–¥åŸç†ï¼ˆä¸€å‡ã€äºŒå‡ã€ä¸‰åŠ ï¼‰åŠ `prefix` æ•°ç»„ä¸ºäº†é¿å¼€åˆ¤æ–­è€Œé¢„ç•™ä¸€åœˆ `0` çš„â€œå“¨å…µæ€æƒ³â€çƒ‚ç†Ÿäºå¿ƒã€‚
